extends layout 

block content 
    // Search bar
    .row.justify-content-left.align-items-top 
        .col-lg-8
            form#latin-search(method="GET", action="/latin")
                // On submit, calls endpoint '/latin' with query params {search: 'input field val', submit: 'normal'}
                // viz. query params are equal to key-value pairs using 'name' and 'value' attributes of input & btn elements

                .input-group.mb-3
                    //label.input-group-text(for="search-input") Meaning
                    //Populate with currently displayed lemma if exists
                    input.form-control.alt-keys#search-input(type="text", name="search", placeholder="Enter a query", value=lemmaData ? lemmaData.main.lemma : '')
                    #alt-letter-popover(style="display: none;")
                    button.btn.btn-success(type="submit", name='submit', value="normal") Search

    // Details display
    // Grammar data comes from main entry
    if lemmaData
        #entry-details
            #details-table
                table 
                    tr
                        td Language 
                        td #{lemmaData.main.lang}
                    tr
                        td Grammar 
                        if lemmaData.main.gender
                            td #{lemmaData.main.pos}, #{lemmaData.main.gender}
                        else
                            td #{lemmaData.main.pos}
                    tr
                        td Pronunciation 
                        td #{lemmaData.main.ipa}
                    tr
                        td Etymology
                        td etym goes here
                    tr
                        td Cognates
                        td Something here?
                    tr
                        td Descendants
                        td offspring here
            
            hr
            #details-meaning
                h5 Meaning
                #senses
                    // Populated later
                
            hr
            #details-declension
                h5 Declension
                p *Latin quiz flashbacks here*
                
            hr
            #details-citations
                h5 Attestations
                ul#citations
                    //Populated later
            
            hr
            #details-related
                h5 Related Words
                if lemmaData.related
                    ul
                        each entry in lemmaData.related
                            li
                                a(href="/latin/lemma/" + entry.lemma_id) #{entry.lemma + (entry.sense_num ? entry.sense_num.split('.')[0] : '')}
                    
        script.
            const INDENT_PX = 50;

            // Populate entries & attestations
            let entries = !{JSON.stringify(lemmaData.senses)};
            let mainEntry = !{JSON.stringify(lemmaData.main)};
            let attestations = [];
            const senseParent = document.getElementById('senses');
            const attestationParent = document.getElementById('citations');

            // Main sense entry
            let mainDiv = document.createElement('div');
            mainDiv.classList.add('main-sense', 'sense');
            if (mainEntry.sense_num) {
                mainDiv.innerHTML += "<b>" + mainEntry.sense_num + ". </b>"
            }
            console.log(mainEntry.entry);
            mainDiv.innerHTML += "<span>" + (mainEntry.entry ? mainEntry.entry : mainEntry.entry_str) + "</span>"
            senseParent.appendChild(mainDiv);
            mainDiv.querySelectorAll('.cit, :not(.cit) > .bibl').forEach((elem) => {
                    attestations.push(elem.cloneNode(true));
                });

            //Sense entries
            entries.forEach((sense) => {
                console.log(sense.entry);
                let entryDiv = document.createElement('div');
                let indent_lvl = Math.floor((sense.sense_num.split('.').length - 1) / 2);
                entryDiv.classList.add('sense', 'indent-' + indent_lvl);
                entryDiv.style = "margin-left:" + (INDENT_PX*indent_lvl) + "px;";
                entryDiv.innerHTML += "<b>" + sense.sense_num.split('.').at(-1) + ". </b>"
                entryDiv.innerHTML += "<span>" + (sense.entry ? sense.entry : sense.entry_str) + "</span>"
                senseParent.appendChild(entryDiv);
                
                entryDiv.querySelectorAll('.cit, :not(.cit) > .bibl').forEach((elem) => {
                    attestations.push(elem.cloneNode(true));
                });
            });
            
            // Populate attestations
            console.log(attestations);
            attestations.forEach((elem) => {
                attestationElement = document.createElement('li');
                attestationElement.appendChild(elem);
                //Indent if no author listed (belongs to previous work?) - cf. acus[2]
                //Could compare URN attribute here if needed
                if (!elem.querySelector('.author')) {
                    attestationElement.style = "margin-left:" + INDENT_PX/2 + "px;";
                }
                attestationParent.appendChild(attestationElement);
            });